<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Pie Chart with EyeDropper</title>
    <style>
     

        .chart0 {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 230px;
            height: 230px;
            border-radius: 50%;
            background: #242424;
            position: relative;
        }

   
        .svg-container {
            width: 40px;
            height: 40px;
            rotate: -45deg;
            position: fixed;
            z-index: 1000;
            margin-bottom: -10px;
        }

        .svg-container svg {
            width: 100%;
            height: 100%;
        }

        .svg-container svg path {
            fill: #242424;
        }

        #controls {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #selectColorBtn {
            padding: 5px 10px;
            border: none;
            background-color: #007bff;
            color: white;
            cursor: pointer;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        #selectColorBtn:disabled {
            background-color: #aaa;
        }
        /* .chart1 {
            width: 220px;
            height: 220px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            transition: transform 0.5s ease;
        } */

    </style>
</head>
<body>
    <!-- <div class="chart0"> -->
        <!-- <div class="svg-container">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
                <path d="M429.6 92.1c4.9-11.9 2.1-25.6-7-34.7s-22.8-11.9-34.7-7l-352 144c-14.2 5.8-22.2 20.8-19.3 35.8s16.1 25.8 31.4 25.8l176 0 0 176c0 15.3 10.8 28.4 25.8 31.4s30-5.1 35.8-19.3l144-352z"/>
            </svg>
        </div> -->
        <!-- <canvas id="pieChart" class="chart1"></canvas> -->
    <!-- </div> -->


    

    <script>
            const canvas = document.createElement('canvas');
            canvas.id = 'pieChart';
            canvas.className = 'chart1';
            canvas.style.width = '220px'
            canvas.style.borderRadius = '50%'
            canvas.style.display = 'flex'
            canvas.style.overflow = 'hidden'
            canvas.style.justifyContent = 'center'
            canvas.style.transition = ' transform 0.5s ease'
            canvas.style.alignItems = 'center'
            document.body.appendChild(canvas);

        let selectedSegment = 0;
        let rotationAngle = 0;
        let data = [];
        let colors = [];

        function drawPieChart(ctx, data, colors, highlightIndex = null) {
            const total = data.reduce((sum, value) => sum + value, 0);
            const radius = 110;
            let startAngle = 0;

            ctx.save();
            ctx.translate(radius, radius);
            ctx.rotate(rotationAngle);

            if (colors.length === 0) {
                // Draw a single slice with the default color if there are no colors
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.arc(0, 0, radius, 0, 2 * Math.PI);
                ctx.closePath();
                ctx.fillStyle = '#242424'; // Default color
                ctx.fill();
            } else {
                data.forEach((value, index) => {
                    const sliceAngle = (value / total) * 2 * Math.PI;
                    const endAngle = startAngle + sliceAngle;

                    ctx.beginPath();
                    ctx.moveTo(0, 0);
                    ctx.arc(0, 0, radius, startAngle, endAngle);
                    ctx.closePath();
                    ctx.fillStyle = colors[index];
                    ctx.fill();

                    if (index === highlightIndex) {
                        ctx.lineWidth = 5;
                        ctx.strokeStyle = '#fff';
                        ctx.stroke();
                    }

                    startAngle = endAngle;
                });
            }

            ctx.restore();
        }

        function updatePieChart() {
            const canvas = document.getElementById('pieChart');
            const ctx = canvas.getContext('2d');
            canvas.width = 220;
            canvas.height = 220;

            const total = data.reduce((sum, value) => sum + value, 0);
            const selectedSliceAngle = (data.slice(0, selectedSegment).reduce((sum, value) => sum + value, 0) / total) * 2 * Math.PI;
            const rotationAdjustment = -selectedSliceAngle;

            rotationAngle += Math.PI / 6;
            document.querySelector('.chart1').style.transform = `rotate(${rotationAngle}rad)`;

            drawPieChart(ctx, data, colors, selectedSegment);
        }

        async function pickColor() {
            try {
                const eyeDropper = new EyeDropper();
                const result = await eyeDropper.open();

                const selectedColor = result.sRGBHex;

                if (!colors.includes(selectedColor)) { // Check for duplicates
                    if (colors.length >= 7) {
                        colors.shift(); // Remove the oldest color if there are already 7
                        data.shift(); // Remove the oldest data entry
                    }

                    colors.push(selectedColor);
                    data.push(25); // Add a new data entry with a default value

                    // Copy the selected color to clipboard
                    navigator.clipboard.writeText(selectedColor).then(() => {
                        console.log('Color copied to clipboard:', selectedColor);
                    }).catch(err => {
                        console.error('Failed to copy color:', err);
                    });

                    updatePieChart();
                } else {
                    console.log('Color already exists:', selectedColor);
                }
            } catch (err) {
                console.error('Failed to pick color:', err);
            }
        }

        async function copySelectedColorToClipboard() {
            try {
                const selectedColor = colors[selectedSegment];
                await navigator.clipboard.writeText(selectedColor);
                console.log('Selected color copied to clipboard:', selectedColor);
            } catch (err) {
                console.error('Failed to copy selected color:', err);
            }
        }

        // document.getElementById('selectColorBtn').addEventListener('click', pickColor);

        document.addEventListener('keydown', (e) => {
            if (e.key === 'v') {
                selectedSegment = (selectedSegment + 1) % data.length;
                updatePieChart();
                copySelectedColorToClipboard(); // Copy the color of the selected segment to the clipboard
            }
            if (e.key === 'r') {
                updatePieChart();
            }

            if(e.key === 'b'){
                // document.getElementById('selectColorBtn').click()
                pickColor()

            }
        });

        window.onload = updatePieChart;
    </script>
</body>
</html>








