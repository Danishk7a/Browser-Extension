<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Color Picker</title>
    <style>
        .color-picker {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: #171717;
  padding: 6px 23px 9px 23px;
  border-radius: 9px;
  box-shadow: 4px 1px 13px 2px black;
  position: relative;
  height: 130px;
  width: 100px;
}
canvas {
  border: 1px solid #ccc;
  cursor: pointer;
  margin-top: 10px;
  border-radius: 9px;
}
input[type="range"] {
  -webkit-appearance: none;
  width: 100px;
  height: 7px;
  border-radius: 5px;
  margin: 10px 0;
}
input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 15px;
  height: 15px;
  border-radius: 50%;
  background: #fff;
  border: 2px solid #000;
  cursor: pointer;
}
input[type="text"] {
  width: 100px;
  padding: 5px;
  border: 1px solid #525252;
  border-radius: 6px;
  color: white;
  background-color: #242424;
}
.color-overlay {
  position: absolute;
  right: 23px;
  bottom: 17px;
  width: 20px;
  height: 20px;
  background-color: rgba(255, 0, 0, 0.3);
  border-radius: 4px;
  z-index: 2;
}
    </style>
</head>
<body>


    <div id="boxy" style="width: 200px; height: 200px;margin: 60px;background-color: blueviolet;">

    </div>

<script>
    const style = `
`;

const boxy = document.getElementById('boxy')
    const styleSheet = document.createElement("style");
    styleSheet.type = "text/css";
    styleSheet.innerText = style;
    document.head.appendChild(styleSheet);

    const colorPickerDiv = document.createElement("div");
    colorPickerDiv.className = "color-picker";

    const canvas = document.createElement("canvas");
    canvas.id = "colorCanvas";
    canvas.width = 100;
    canvas.height = 60;

    const hueSlider = document.createElement("input");
    hueSlider.type = "range";
    hueSlider.id = "hueSlider";
    hueSlider.min = 0;
    hueSlider.max = 360;
    hueSlider.value = 0;

    const controlsDiv = document.createElement("div");
    controlsDiv.className = "controls";

    const hexInput = document.createElement("input");
    hexInput.type = "text";
    hexInput.id = "hexInput";
    hexInput.value = "#000000";
    hexInput.maxLength = 7;

    const colorOverlay = document.createElement("div");
    colorOverlay.className = "color-overlay";
    colorOverlay.id = "colorPreview";

    controlsDiv.appendChild(hexInput);
    controlsDiv.appendChild(colorOverlay);
    colorPickerDiv.appendChild(canvas);
    colorPickerDiv.appendChild(hueSlider);
    colorPickerDiv.appendChild(controlsDiv);
    document.body.appendChild(colorPickerDiv);

    const ctx = canvas.getContext('2d');
    let isDragging = false;

    function drawColorCanvas(hue) {
        for (let x = 0; x < canvas.width; x++) {
            for (let y = 0; y < canvas.height; y++) {
                const saturation = x / canvas.width;
                const lightness = 1 - y / canvas.height;
                const [r, g, b] = hslToRgb(hue / 360, saturation, lightness);
                ctx.fillStyle = `rgb(${r}, ${g}, ${b})`;
                ctx.fillRect(x, y, 1, 1);
            }
        }
    }

    function hslToRgb(h, s, l) {
        let r, g, b;
        if (s === 0) {
            r = g = b = l;
        } else {
            const hue2rgb = (p, q, t) => {
                if (t < 0) t += 1;
                if (t > 1) t -= 1;
                if (t < 1 / 6) return p + (q - p) * 6 * t;
                if (t < 1 / 2) return q;
                if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;
                return p;
            };
            const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
            const p = 2 * l - q;
            r = hue2rgb(p, q, h + 1 / 3);
            g = hue2rgb(p, q, h);
            b = hue2rgb(p, q, h - 1 / 3);
        }
        return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];
    }

    function rgbToHex(r, g, b) {
        return `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).padStart(6, '0')}`;
    }

    function updateColorCanvas() {
        const hue = hueSlider.value;
        drawColorCanvas(hue);
        const [r, g, b] = hslToRgb(hue / 360, 1, 0.5);
        const hex = rgbToHex(r, g, b);
        colorOverlay.style.backgroundColor = hex;
        hexInput.value = hex;
        boxy.style.backgroundColor = hex;
    }

    function getColor(event) {
        const rect = canvas.getBoundingClientRect();
        const x = Math.max(0, Math.min(event.clientX - rect.left, canvas.width - 1));
        const y = Math.max(0, Math.min(event.clientY - rect.top, canvas.height - 1));
        const imageData = ctx.getImageData(x, y, 1, 1).data;
        const r = imageData[0];
        const g = imageData[1];
        const b = imageData[2];
        const hex = rgbToHex(r, g, b);
        hexInput.value = hex;
        colorOverlay.style.backgroundColor = hex;
        boxy.style.backgroundColor = hex;
    }

    hueSlider.addEventListener('input', updateColorCanvas);
    canvas.addEventListener('mousedown', (event) => {
        isDragging = true;
        getColor(event);
    });
    canvas.addEventListener('mousemove', (event) => {
        if (isDragging) {
            getColor(event);
        }
    });
    document.addEventListener('mouseup', () => {
        isDragging = false;
    });

    hexInput.addEventListener('input', (event) => {
        let hex = event.target.value;
        if (!hex.startsWith('#')) {
            hex = '#' + hex;
        }
        if (/^#[0-9A-Fa-f]{6}$/.test(hex)) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            const [h, s, l] = rgbToHsl(r, g, b);
            hueSlider.value = Math.round(h * 360);
            updateColorCanvas();
        }
    });

    function rgbToHsl(r, g, b) {
        r /= 255; g /= 255; b /= 255;
        const max = Math.max(r, g, b), min = Math.min(r, g, b);
        let h, s, l = (max + min) / 2;
        if (max === min) {
            h = s = 0; 
        } else {
            const d = max - min;
            s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
            switch (max) {
                case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                case g: h = (b - r) / d + 2; break;
                case b: h = (r - g) / d + 4; break;
            }
            h /= 6;
        }
        return [h, s, l];
    }

    updateColorCanvas();
</script>

</body>
</html>
